<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Comparing Cloud</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        table { border-collapse: collapse; width: 100%; font-size: 13px;}
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
    </style>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta http-equiv="refresh" content="600">
</head>
<body>
    <h1>Comparing Cloud</h1>
    <div class="provider-buttons" role="group" aria-label="Provider-Filter">
        <button type="button" class="pill pill-aws"   data-provider="AWS">Amazon Web Services</button>
        <button type="button" class="pill pill-azure" data-provider="Azure">Microsoft Azure</button>
        <button type="button" class="pill pill-gcp"   data-provider="GCP">Google Cloud Platform</button>
    </div>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css', v=last_updated) }}">
    <div class="spacer"></div>
    <form method="get" action="/">
    {% set active_provider = request.args.get('provider','') %}
    {% set services_map = {
        'AWS':   ['EC2','S3','EBS','RDS'],
        'Azure': ['Virtual Machines','Cloud Storage','Disk Storage','SQL Database'],
        'GCP':   ['Compute Engine','Cloud Storage','Persistent Disk','Cloud SQL']
    } %}
    {% set svc_opts = services_map.get(active_provider, []) %}
    <input type="hidden" name="provider" id="providerHidden" value="{{ active_provider }}">
    <label for="q">Suchen:</label>
    <input type="text" id="q" name="q" placeholder="Anbieter, SKU oder Resource Name"
            value="{{ request.args.get('q','') }}" style="min-width:280px">
    <label for="service" style="margin-left:12px;">Service:</label>
    <select id="service" name="service">
        {% if not svc_opts %}
        <option value="">Provider w√§hlen</option>
        {% else %}
        <option value="">Alle Services</option>
        {% for s in svc_opts %}
            <option value="{{ s }}" {% if request.args.get('service') == s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
        {% endif %}
    </select>

    <button type="submit" style="margin-left:12px;">Suchen</button>
    <button type="button" onclick="window.location.href='/'" style="margin-left: 10px;">Alle Filter zur√ºcksetzen</button>
    <button type="button" onclick="clearSelection()" style="margin-left: 10px;">Auswahl zur√ºcksetzen</button>
    </form>

    <div style="position: absolute; top: 20px; right: 140px; display: flex; gap: 10px;">
        <a href="{{ url_for('download_csv', **request.args) }}" class="btn-blue">CSV Download</a>
        <a href="{{ url_for('download_pdf', **request.args) }}" class="btn-blue">PDF Download</a>
    </div>

    <form id="compareForm" method="get" action="/compare" target="_blank">
        <button type="submit" id="compareBtn" disabled style="
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        ">üîç Vergleich</button>
    </form>
    <div class="spacer"></div>
    <form id="compareForm" method="get" action="/compare" target="_blank">
    <table>
        <tr>
        <th>‚úì</th>
        <th>
            <a href="?{% for k, v in request.args.items() if k != 'sort_by' and k != 'order' %}{{ k }}={{ v }}&{% endfor %}sort_by=provider&order={{ 'desc' if sort_by == 'provider' and order == 'asc' else 'asc' }}">
                Anbieter {% if sort_by == 'provider' %}{{ '‚Üë' if order == 'asc' else '‚Üì' }}{% endif %}
            </a>
        </th>
        <th>
            <a href="?{% for k, v in request.args.items() if k != 'sort_by' and k != 'order' %}{{ k }}={{ v }}&{% endfor %}sort_by=service&order={{ 'desc' if sort_by == 'service' and order == 'asc' else 'asc' }}">
                Service {% if sort_by == 'service' %}{{ '‚Üë' if order == 'asc' else '‚Üì' }}{% endif %}
            </a>
        </th>
        <th>
            <a href="?{% for k, v in request.args.items() if k != 'sort_by' and k != 'order' %}{{ k }}={{ v }}&{% endfor %}sort_by=sku&order={{ 'desc' if sort_by == 'sku' and order == 'asc' else 'asc' }}">
                Service ID {% if sort_by == 'sku' %}{{ '‚Üë' if order == 'asc' else '‚Üì' }}{% endif %}
            </a>
        </th>
        <th>
            <a href="?{% for k, v in request.args.items() if k != 'sort_by' and k != 'order' %}{{ k }}={{ v }}&{% endfor %}sort_by=resource_name&order={{ 'desc' if sort_by == 'resource_name' and order == 'asc' else 'asc' }}">
                Beschreibung {% if sort_by == 'resource_name' %}{{ '‚Üë' if order == 'asc' else '‚Üì' }}{% endif %}
            </a>
        </th>
        <th>
            <a href="?{% for k, v in request.args.items() if k != 'sort_by' and k != 'order' %}{{ k }}={{ v }}&{% endfor %}sort_by=region&order={{ 'desc' if sort_by == 'region' and order == 'asc' else 'asc' }}">
                Region {% if sort_by == 'region' %}{{ '‚Üë' if order == 'asc' else '‚Üì' }}{% endif %}
            </a>
        </th>
        <th>
            <a href="?{% for k, v in request.args.items() if k != 'sort_by' and k != 'order' %}{{ k }}={{ v }}&{% endfor %}sort_by=price_per_unit&order={{ 'desc' if sort_by == 'price_per_unit' and order == 'asc' else 'asc' }}">
                Preis (W√§hrung/Einheit) {% if sort_by == 'price_per_unit' %}{{ '‚Üë' if order == 'asc' else '‚Üì' }}{% endif %}
            </a>
        </th>
        <th>Alternativen</th>
        </tr>
        {% for row in prices %}
        <tr>
            <td>
                <input type="checkbox" name="ids" value="{{ row.id }}" onclick="handleCheckbox(this)">
            </td>
            <td>{{ row.provider }}</td>
            <td>{{ row.service }}</td>
            <td>{{ row.sku }}</td>
            <td>{{ row.resource_name }}</td>
            <td>{{ row.region }}</td>
            <td>{{ row.price_per_unit | round(4) }} {{ row.unit }}</td>
            <td>
                <a href="{{ url_for('alternatives', entry_id=row.id) }}">Alternative anzeigen</a>
            </td>
        </tr>
        {% endfor %}
    </table>

    <p>Letzte Aktualisierung: {{ last_updated }}</p>
    
    </form>
    <div style="margin-top: 20px;">
        {% if page > 1 %}
            <a href="/?page={{ page - 1 }}">‚¨ÖÔ∏è Zur√ºck</a>
        {% endif %}

        <span>Seite {{ page }} von {{ total_pages }}</span>

        {% if page < total_pages %}
            <a href="/?page={{ page + 1 }}">N√§chste Seite</a>
        {% endif %}
    </div>

    <script src="{{ url_for('static', filename='js/provider-form-sync.js',  v=last_updated) }}" defer></script>
    <script src="{{ url_for('static', filename='js/compare-selection.js',   v=last_updated) }}" defer></script>
    <script src="{{ url_for('static', filename='js/provider-buttons.js',    v=last_updated) }}" defer></script>
    
</body>
</html>
